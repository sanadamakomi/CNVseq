#' @title Calculating overlap ratio of two granges
#' @param gr The query grange object of region.
#' @param db_gr The subject grange object of region.
#' @param size An integer of size to resize the query grange, default: 0.
#' @export
#' @import IRanges
#' @import GenomicRanges
#' @import S4Vectors
#' @import GenomicAlignments
calculate_overlap_ratio <- function(gr, db_gr, size=0) {
    grf <- trim(resize(gr, width(gr)+size, "center"))
    hit <- findOverlaps(grf, db_gr)
    if (length(hit) > 0) {
        dat <- lapply(subjectHits(hit), function(i) {
            interval <- pintersect(grf, db_gr[i])
            query_ratio <- round(width(interval)/width(grf),2)
            subject_ratio <- round(width(interval)/width(db_gr[i]),2)

            sub_df <- as.data.frame(mcols(db_gr))[i,,drop=FALSE]
            sub_df <- cbind(data.frame("query_ratio"=query_ratio, subject_ratio=subject_ratio), sub_df)
            return(sub_df)
        })
        dat <- do.call("rbind", dat)
    } else {
        dat <- NULL
    }
    return(dat)
}
