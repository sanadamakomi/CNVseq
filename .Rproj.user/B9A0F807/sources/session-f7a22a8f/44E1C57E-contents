#' @title Annotate VCF file.
#' @param vcf_path Path of VCF file
#' @param out_path Path of output file. File encoding is GBK.
#' @param tool_path Path of annovar script.
#' @param db_path Path of annovar database directory.
#' @export
#' @importFrom utils write.table
annote_vcf <- function(vcf_path, out_path, tool_path, db_path) {
    if (is.null(vcf_path)) stop("Input --vcfFile")
    if (!file.exists(vcf_path)) stop(paste0("Error: File no exist:\n", vcf_path))

    if (is.null(out_path)) out_path <- gsub(".vcf$", ".cnv.txt", vcf_path)
    out_prefix <- gsub(".txt$", "", out_path)
    if (!dir.exists(dirname(out_path))) dir.create(dirname(out_path), recursive = TRUE)

    cmd <- paste(
        "perl", tool_path, vcf_path, "-vcfinput", db_path, "-buildver hg19 -out", out_prefix, "-otherinfo -remove -protocol refGene,cytoBand,omimPheno,hpo_20180828,pseudogene,ClinGenHI,ClinGenTS,gnomad_pLI,gnomad_zScore,morbidGene,codingGene -operation g,r,r,r,r,r,r,r,r,r,r -argument ,,,'--minqueryfrac 0.5',,,,,,, -nastring . ", sep=" ")
    system(cmd)

    # format result
    result_path <- paste0(out_prefix, ".hg19_multianno.txt")
    result_cnv <- format_change(result_path, db_path)
    result_sort <- sort_result(result_cnv)

    # output
    write.table(result_sort, file = out_path, row.names = FALSE, col.names = TRUE, quote = FALSE, sep = "\t", fileEncoding="gbk")
}
